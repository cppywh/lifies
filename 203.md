## æœ¯è¯­è¡¨

**KEM**	key-encapsulation mechanism	ï¼ˆéå¯¹ç§°å¯†é’¥ åŠ å¯† å¯¹ç§°å¯†é’¥çš„ç§å­shared secret = ssï¼‰

**ML-KEM**	Module-Lattice-Based Key-Encapsulation Mechanism

**MLWE**	Module Learning With Errors 

**PKE**	Public-Key Encryption	ï¼ˆéå¯¹ç§°å¯†é’¥ åŠ å¯† Mï¼‰

**AES**	Advanced Encryption Standard

**CBD**	Centered Binomial Distribution	ä¸­å¿ƒäºŒé¡¹åˆ†å¸ƒ   æ¯”ç‰¹è§†è§’ï¼ˆå®ç°å¸¸ç”¨ï¼‰ï¼šå– 2Î·2\eta2Î· ä¸ªç‹¬ç«‹å‡åŒ€æ¯”ç‰¹ b1,â€¦,bÎ·,b1â€²,â€¦,bÎ·â€²
$$
Z = \sum_{i=1}^{\eta} b_i - \sum_{i=1}^{\eta} b'_i.
$$
**LWE**	Learning with Errors	å¸¦è¯¯å·®å­¦ä¹ é—®é¢˜

**LWE å®šä¹‰ï¼ˆæœ€å¸¸è§çš„ *decision-LWE*ï¼‰åœ¨æ•´æ•°æ¨¡ q ä¸Šï¼Œå¾ˆå¤šâ€œå¸¦å°å™ªå£°çš„çº¿æ€§ç­‰å¼â€éšè—äº†ç§˜å¯† sã€‚**

- è®¾æ¨¡æ•° \(q\)ã€ç»´åº¦ \(n\)ã€ç§˜å¯†å‘é‡ **$ \mathbf{s}\in \mathbb{Z}_q^{\,n} $**ã€‚
- ç»™ä½ å¾ˆå¤šæ ·æœ¬ **$ (\mathbf{a}_i,\; b_i) $** ï¼š
  $$
  \mathbf{a}_i \xleftarrow{\$}\, \mathbb{Z}_q^{\,n},\qquad
  e_i \leftarrow \chi,\qquad
  b_i = \langle \mathbf{a}_i,\mathbf{s}\rangle + e_i \pmod q .
  $$

å…¶ä¸­ï¼Œ\(e_i\) æ˜¯æ¥è‡ªâ€œå°åˆ†å¸ƒâ€ \(\chi\) çš„è¯¯å·®ï¼ˆå¦‚**ç¦»æ•£é«˜æ–¯** / **CBD**ï¼‰ã€‚

**é—®é¢˜ï¼š** åŒºåˆ†è¿™äº›æ ·æœ¬ä¸**å®Œå…¨å‡åŒ€éšæœº**æ ·æœ¬æ˜¯å¦å¯è¡Œï¼ˆdecision-LWEï¼‰ï¼›æˆ–**æ¢å¤** **$\mathbf{s}\\$**ï¼ˆsearch-LWEï¼‰ã€‚

> ç›´è§‰ï¼šè‹¥æ²¡æœ‰å™ªå£°ï¼ˆ\(e_i=0\)ï¼‰ï¼Œè¿™æ˜¯çº¿æ€§æ–¹ç¨‹ï¼Œè½»æ˜“è§£ï¼›ä¸€æ—¦åŠ å…¥å°å™ªå£°ï¼Œæ±‚è§£/åŒºåˆ†å˜å¾—å›°éš¾ã€‚



**MLWE**	Module Learning with Errors	æ¨¡å¸¦è¯¯å·®å­¦ä¹ 

æŠŠâ€œæ•´æ•°å‘é‡â€æ¢æˆâ€œ**å¤šé¡¹å¼å‘é‡**â€ï¼Œä¸”ç»´åº¦ç”±å‚æ•° k æ§åˆ¶â€”â€”æ—¢ä¸åƒæ ‡å‡† LWE é‚£ä¹ˆâ€œæ‰å¹³â€ï¼Œä¹Ÿä¸æŠŠç»“æ„åŠ åˆ°æè‡´ï¼ˆåƒ Ring-LWE é‚£æ ·ï¼‰ã€‚è¿™æ ·æ—¢å¿«ï¼Œåˆæ›´ä¿å®ˆåœ°å¼•å…¥ç»“æ„ï¼ŒæŠ—å·²çŸ¥æ”»å‡»æ›´ç¨³ã€‚

MLWE å®šä¹‰ï¼ˆå¸¸è§è¡¨è¿°ï¼‰

- å·¥ä½œç¯ï¼š$ R_q = \mathbb{Z}_q[x]/(x^n + 1) $ï¼ˆ$n$ å¸¸å– $256$ï¼Œä¾¿äº NTTï¼‰ã€‚
- ç§˜å¯†ä¸å™ªå£°æ¥è‡ªå°åˆ†å¸ƒ $ \chi $ï¼ˆå¦‚ **ç¦»æ•£é«˜æ–¯** æˆ– **CBD$_\eta$**ï¼‰ã€‚
- ç»™å‡ºæ ·æœ¬å¯¹ $ (\mathbf{a}_i, b_i) $ï¼š
$$
\mathbf{a}_i \xleftarrow{\$}\, R_q^{\,k},\qquad
\mathbf{e}_i \leftarrow \chi^{\,k},\qquad
b_i \;=\; \langle \mathbf{a}_i,\mathbf{s}\rangle \;+\; e_i \;\in\; R_q ,
$$

å…¶ä¸­ $ \mathbf{s}\in R_q^{\,k} $ æ˜¯ç§˜å¯†ï¼Œå†…ç§¯åœ¨ç¯ä¸Šè¿›è¡Œã€‚

**Decision-MLWE**ï¼šåŒºåˆ† $ (\mathbf{a}_i, b_i) $ ä¸å®Œå…¨å‡åŒ€éšæœºæ˜¯å¦å¯è¡Œã€‚  
**Search-MLWE**ï¼šä»æ ·æœ¬æ¢å¤ $ \mathbf{s} $ã€‚



**NTT**	Number-Theoretic Transform	æ•°è®ºå˜æ¢

**PRF**	Pseudorandom Function	ä¼ªéšæœºç”Ÿæˆå‡½æ•°

**RBG**	Random Bit Generator	éšæœºä½ç”Ÿæˆå™¨

**SHA**	Secure Hash Algorithm

**SHAKE**	Secure Hash Algorithm KECCAK	SHAKE å“ˆå¸Œå‡½æ•°ï¼šåŸºäº KECCAK ç®—æ³•çš„å®‰å…¨å“ˆå¸Œç®—æ³•ï¼Œå±äºå¯æ‰©å±•è¾“å‡ºå‡½æ•°ï¼ˆXOFï¼‰çš„ä¸€ç§

**XOF**	Extendable-Output Function	å¯æ‰©å±•è¾“å‡ºå‡½æ•°ï¼šä¸€ç§å¯†ç å­¦å“ˆå¸Œå‡½æ•°ï¼Œå…¶æ ¸å¿ƒç‰¹æ€§æ˜¯è¾“å‡ºé•¿åº¦å¯æ ¹æ®éœ€æ±‚çµæ´»è°ƒæ•´ï¼ˆè€Œéå›ºå®šé•¿åº¦ï¼‰

> æœ¬é¡µç»Ÿä¸€æ–‡æ¡£ä¸­çš„ç¬¦å·ä¸è¿ç®—è®°å·ã€‚è‹¥æ— ç‰¹åˆ«è¯´æ˜ï¼Œè¿ç®—åœ¨æ¨¡ $q$ æˆ–æŒ‡å®šç¯ä¸Šè¿›è¡Œã€‚

**åŸºæœ¬å¸¸é‡ä¸é›†åˆ**

- **$n$** â€” å›ºå®šä¸º **256**ï¼ˆå¤šé¡¹å¼é˜¶æ•°ï¼‰ã€‚
- **$q$** â€” ç´ æ•° **3329**ï¼Œæ»¡è¶³ $q = 2^8\cdot 13 + 1$ã€‚
- **$\zeta$** â€” æ•´æ•° **17**ï¼Œæ¨¡ $q$ çš„ **$n$ æ¬¡æœ¬åŸå•ä½æ ¹**ï¼ˆç”¨äº NTTï¼‰ã€‚
- **$\mathbb{B}$** â€” å­—èŠ‚é›†åˆ $\{0,1,\dots,255\}$ã€‚
- **$\mathbb{Q}$** â€” æœ‰ç†æ•°é›†ï¼›**$\mathbb{Z}$** â€” æ•´æ•°é›†ã€‚
- **$\mathbb{Z}_m$** â€” æ•´æ•°æ¨¡ $m$ çš„ç¯ï¼ˆå…ƒç´  $0..m-1$ï¼ŒåŠ /ä¹˜ $\bmod m$ï¼‰ã€‚
- **$\mathbb{Z}_m^n$** â€” $\mathbb{Z}_m$ ä¸Šé•¿åº¦ä¸º $n$ çš„æ•°ç»„/å‘é‡é›†åˆã€‚è¡¨ç¤ºç”± Z*m* ä¸­å…ƒç´ æ„æˆçš„ â„“=n ç»´æœ‰åºæ•°ç»„é›†åˆï¼ˆå³ â€œZ*m* ä¸Šçš„ â„“ ç»´æ•°ç»„ç©ºé—´â€ï¼‰ï¼Œæ•°ç»„ä¸­æ¯ä¸ªåˆ†é‡å‡å±äº Z*m*

**ç¯ã€NTT ä¸åˆ†å¸ƒ**

- **$R_q$** â€” å¤šé¡¹å¼ç¯ $\mathbb{Z}_q[X]/(X^n+1)$ã€‚  
  å…ƒç´  $f = f_0 + f_1X + \dots + f_{255}X^{255}$ï¼Œç³»æ•° $f_j\in\mathbb{Z}_q$ã€‚
- **$T_q$** â€” $R_q$ åœ¨ **æ•°è®ºå˜æ¢ï¼ˆNTTï¼‰** ä¸‹çš„åƒï¼›å…¶å…ƒç´ æ˜¯ $R_q$ å…ƒç´ çš„ **NTT è¡¨ç¤º**ã€‚
- **$\hat f$** â€” $f\in R_q$ çš„ NTT è¡¨ç¤ºï¼š$\hat f = \mathrm{NTT}(f)\in T_q$ã€‚
- **$D_\eta(R_q)$** â€” $R_q$ ä¸Šçš„â€œå°ç³»æ•°åˆ†å¸ƒâ€ï¼ˆå¦‚ç¦»æ•£é«˜æ–¯æˆ– CBD$_\eta$ï¼‰ï¼Œ$\eta\in\{2,3\}$ã€‚

> **NTT/é€† NTTï¼ˆå‚è€ƒï¼‰**  
> $$
> \hat f_k=\sum_{j=0}^{n-1} f_j\,\zeta^{jk}\pmod q,\qquad
> f_j = n^{-1}\!\sum_{k=0}^{n-1}\hat f_k\,\zeta^{-jk}\pmod q,\quad
> n^{-1}\equiv n^{-1}\ (\bmod\ q).
> $$

**çº¿æ€§ä»£æ•°ä¸ä¸‹æ ‡è®°å·**

- **$\circ$** â€” çº¿æ€§ä»£æ•°ç»„åˆ/ä½œç”¨ï¼ˆç³»æ•°åœ¨ $R_q$ æˆ– $T_q$ï¼‰ï¼Œå¦‚ $A\circ\mathbf{v}$ã€‚
- **$\times_{T_q}$** â€” ç³»æ•°æ•°ç»„ä¸Šçš„ä¹˜æ³•ï¼Œç­‰ä»·äºç¯ $T_q$ ä¸­çš„ä¹˜ç§¯ï¼ˆNTT åŸŸé€ç‚¹ä¹˜ï¼‰ã€‚
- **$f_j$** â€” å¤šé¡¹å¼ $f$ çš„ $X^j$ çš„ç³»æ•°ã€‚
- **$\mathbf{v}^T,\ \mathbf{A}^T$** â€” å‘é‡/çŸ©é˜µçš„è½¬ç½®ã€‚
- **$A\mid B$** â€” æ•°ç»„ï¼ˆæˆ–æ¯”ç‰¹ä¸²ï¼‰**æ‹¼æ¥**ï¼Œå…ˆ $A$ å $B$ã€‚
- **$B[i]$** â€” æ•°ç»„ $B$ çš„ç¬¬ $i$ é¡¹ï¼ˆä» 0 èµ·ï¼‰ã€‚
- **$B[k:m]$** â€” å­æ•°ç»„ $(B[k],B[k+1],\dots,B[m-1])$ã€‚
- **$\lvert B\rvert$** â€” è‹¥ $B$ æ˜¯æ•°ï¼Œå–ç»å¯¹å€¼ï¼›è‹¥æ˜¯æ•°ç»„ï¼Œå–é•¿åº¦ã€‚

**å–æ•´ä¸ç­‰å·**

- **$\lceil x\rceil$** ä¸Šå–æ•´ï¼›**$\lfloor x\rfloor$** ä¸‹å–æ•´ï¼›  
- **$[x]$** å››èˆäº”å…¥åˆ°æœ€è¿‘æ•´æ•°ï¼›è‹¥ $x=y+\tfrac12$ã€$y\in\mathbb{Z}$ï¼Œè§„å®š $[x]=y+1$ã€‚
- **$:=$** å·¦è¾¹**å®šä¹‰ä¸º**å³è¾¹è¡¨è¾¾å¼ã€‚

**æ¨¡ä¸æ¯”ç‰¹æ“ä½œ**

- **$r \bmod m$** â€” $r$ å¯¹ $m$ çš„æœ€å°éè´Ÿå‰©ä½™ $r'\in\{0,\dots,m-1\}$ã€‚
- **$\operatorname{BitRev}_7(r)$** â€” 7 ä½æ•´æ•°çš„**æ¯”ç‰¹åè½¬**ã€‚  
  è‹¥ $r=r_0+2r_1+4r_2+\cdots+64r_6$ï¼ˆ$r_i\in\{0,1\}$ï¼‰ï¼Œ  
  åˆ™ $\operatorname{BitRev}_7(r)=r_6+2r_5+4r_4+\cdots+64r_0$ã€‚

**ä¼ªä»£ç ä¸éšæœºæ€§**

- **$s \leftarrow x$** â€” èµ‹å€¼ï¼šæŠŠ $x$ çš„å€¼ç»™å˜é‡ $s$ã€‚
- **$s \xleftarrow{\$} \mathbb{B}^\ell$** â€” ä» $\mathbb{B}^\ell$ **å‡åŒ€éšæœºé‡‡æ ·**å­—èŠ‚æ•°ç»„èµ‹ç»™ $s$ã€‚  
  *éšæœºæ€§è¦æ±‚ï¼šæ¥è‡ªç»è¿‡æ‰¹å‡†çš„ RBGï¼ˆè§å®ç°è§„èŒƒï¼‰ã€‚*
- **$\perp$** â€” å¤±è´¥/æ— è¾“å‡ºï¼ˆerror / no outputï¼‰ã€‚

---

**é€Ÿè®°ï¼ˆKyber å¸¸ç”¨å‚æ•°ï¼‰**

- $n=256$ï¼Œ$q=3329$ï¼Œæ¨¡å¤šé¡¹å¼ $X^n+1$ï¼›NTT ä½¿ç”¨ $n$ æ¬¡æœ¬åŸæ ¹ $\zeta$ çš„å¹‚ã€‚
- ç¯ä¸Šå·ç§¯ï¼š$\mathrm{NTT}(a*b)=\mathrm{NTT}(a)\odot\mathrm{NTT}(b)$ï¼ˆç‚¹ä¹˜ï¼‰ï¼Œå†é€† NTTã€‚



## å…¬å¼

a certain ring ğ‘…ğ‘ 


$$
f \;=\; f_0 + f_1 X + \cdots + f_{255} X^{255} \in R_q
$$

$$
(f_0,\,f_1,\,\ldots,\,f_{255}) \in \mathbb{Z}_q^{256}
$$

$$
\text{Array view of } f:\quad f[i] = f_i \, .
$$

an isomorphic ring ğ‘‡ğ‘
$$
\hat{g} \;=\; (\hat{g}_{0,0}+\hat{g}_{0,1}X,\; \hat{g}_{1,0}+\hat{g}_{1,1}X,\; \ldots,\; \hat{g}_{127,0}+\hat{g}_{127,1}X)\; \in\; T_q
$$

$$
(\hat{g}_{0,0},\,\hat{g}_{0,1},\,\hat{g}_{1,0},\,\hat{g}_{1,1},\,\ldots,\,\hat{g}_{127,0},\,\hat{g}_{127,1}) \in \mathbb{Z}_q^{256}
$$

$$
\hat{g}[2i] = \hat{g}_{i,0},\qquad \hat{g}[2i+1] = \hat{g}_{i,1},\quad i \in \{0,1,\ldots,127\}\, .
$$

An essential operation in ML-KEM is the number-theoretic transform (NTT), which maps a polynomial $f$ in a certain ring $R_q$ to its â€œNTT representationâ€ $\hat{f}$ in an isomorphic ring $T_q$.
$$
\mathrm{NTT}: R_q \to T_q,\qquad f \mapsto \hat{f}.
$$
è‹¥ $\hat f,\hat g\in\mathbb{Z}_q^{256}$ï¼Œåˆ™

$$
\hat{h}\leftarrow\hat{f}\times_{T_q}\hat{g}
\quad\text{means}\quad
\hat{h}\leftarrow\mathrm{MultiplyNTTs}(\hat f,\hat g).
$$

The result is an array $\hat h\in\mathbb{Z}_q^{256}$.
$$
(\hat f_{i,0}+\hat f_{i,1}X)(\hat g_{i,0}+\hat g_{i,1}X)
\equiv
(\hat f_{i,0}\hat g_{i,0}+\zeta_i\,\hat f_{i,1}\hat g_{i,1})
+(\hat f_{i,0}\hat g_{i,1}+\hat f_{i,1}\hat g_{i,0})X
\pmod{X^{2}-\zeta_i}.
$$

$$
\begin{aligned}
\hat{h}[2i]   &= \hat{f}[2i]\hat{g}[2i] \;+\; \zeta_i\,\hat{f}[2i+1]\hat{g}[2i+1]\;\pmod{q},\\
\hat{h}[2i+1] &= \hat{f}[2i]\hat{g}[2i+1] \;+\; \hat{f}[2i+1]\hat{g}[2i]\;\pmod{q},
\end{aligned}
\qquad i\in\{0,1,\ldots,127\}.
$$



**2.4.6 å‘é‡ä¸çŸ©é˜µåœ¨ NTT è¡¨ç¤ºä¸­çš„è¿ç®—**	ç²—å†™ä»£è¡¨å‘é‡æˆ–çŸ©é˜µ
$$
\mathbf v \in (\mathbb Z_q^{256})^k \qquad
\hat{\mathbf v} \in (\mathbb Z_q^{256})^k
$$

æŒ‰åæ ‡åš NTT/é€† NTTï¼š
$$
\hat{\mathbf v} \leftarrow \mathrm{NTT}(\mathbf v)
\quad\Leftrightarrow\quad
\hat{\mathbf v}[i] = \mathrm{NTT}(\mathbf v[i]) \in \mathbb Z_q^{256}.
$$

çŸ©é˜µ $\hat{\mathbf A}$ ä¸º $(k\times k)$ï¼Œä¸” $\hat{\mathbf A}[i,j] \in \mathbb Z_q^{256}$ã€‚

çŸ©é˜µâ€“å‘é‡ä¹˜æ³•ï¼ˆåœ¨ $T_q$ ä¸­ï¼‰
$$
\hat{\mathbf w} \leftarrow \hat{\mathbf A} \circ \hat{\mathbf v}
\quad\Rightarrow\quad
\hat{\mathbf w}[i] = \sum_{j=0}^{k-1} \hat{\mathbf A}[i,j] \times_{T_q} \hat{\mathbf v}[j].
$$

è¿™é‡Œçš„ â€œ$+$â€ æ˜¯æ•°ç»„é€åæ ‡ç›¸åŠ ï¼ˆæ¨¡ $q$ï¼‰ï¼›â€œ$\times_{T_q}$â€ æ˜¯ NTT åŸŸä¹˜æ³•ï¼šè¾“å…¥ä¸¤ä¸ªé•¿åº¦ $256$ çš„æ•°ç»„ï¼Œè¾“å‡ºä¸€ä¸ªæ–°çš„é•¿åº¦ $256$ çš„æ•°ç»„ã€‚

å½¢çŠ¶ç¤ºæ„ï¼ˆä»¥ $k=3$ ä¸ºä¾‹ï¼‰
$$
\mathbf v=
\begin{bmatrix}
\mathbf f^{(0)}\\[2pt]\mathbf f^{(1)}\\[2pt]\mathbf f^{(2)}
\end{bmatrix},\qquad
\mathbf f^{(i)}=(f^{(i)}_0,\ldots,f^{(i)}_{255}) \in \mathbb Z_q^{256}.
$$

$$
\hat{\mathbf A}=
\begin{bmatrix}
\hat{\mathbf a}_{00}&\hat{\mathbf a}_{01}&\hat{\mathbf a}_{02}\\
\hat{\mathbf a}_{10}&\hat{\mathbf a}_{11}&\hat{\mathbf a}_{12}\\
\hat{\mathbf a}_{20}&\hat{\mathbf a}_{21}&\hat{\mathbf a}_{22}
\end{bmatrix},\qquad
\hat{\mathbf a}_{ij}\in \mathbb Z_q^{256}.
$$

$$
\hat{\mathbf w} \leftarrow \hat{\mathbf A} \circ \hat{\mathbf v}
\Rightarrow
\hat{\mathbf w}[i] = \sum_{j=0}^2 \hat{\mathbf a}_{ij} \times_{T_q} \hat{\mathbf v}[j].
$$

è¿·ä½ ç®—ä¾‹ï¼ˆæ¼”ç¤ºï¼›æŠŠ 256 ç¼©æˆ 4ï¼Œå– $q=17$ï¼Œ$\zeta_0=3,\ \zeta_1=5$ï¼‰

ä¸€æ­¥åŸºä¹˜æ³•ï¼šä»¤ $\hat f=(1,2,3,4)$ï¼Œ$\hat g=(6,5,4,3)$ï¼Œå¾—åˆ°
$$
\hat h=(2,0,4,8),
$$
å…¶ä¸­
$$
\hat h[0]\equiv 1\cdot6+3\cdot2\cdot5=36\equiv2,\quad
\hat h[1]\equiv 1\cdot5+2\cdot6=17\equiv0,
$$
$$
\hat h[2]\equiv 3\cdot4+5\cdot4\cdot3=72\equiv4,\quad
\hat h[3]\equiv 3\cdot3+4\cdot4=25\equiv8 \pmod{17}.
$$

ä¸€ä¸ª $2\times2$ çš„çŸ©é˜µâ€“å‘é‡ä¹˜ï¼š
$$
\hat{\mathbf A}=
\begin{bmatrix}
(1,2,3,4)&(2,1,2,1)\\
(0,1,0,1)&(1,0,1,0)
\end{bmatrix},\qquad
\hat{\mathbf v}=\begin{bmatrix}(6,5,4,3)\\(3,3,3,3)\end{bmatrix}.
$$

$$
\hat{\mathbf A}[0,0]\times_{T_q}\hat{\mathbf v}[0]=(2,0,4,8),\quad
\hat{\mathbf A}[0,1]\times_{T_q}\hat{\mathbf v}[1]=(15,9,4,9),
$$
$$
\hat{\mathbf w}[0]\equiv(2,0,4,8)+(15,9,4,9)=(17,9,8,17)\equiv(0,9,8,0)\pmod{17}.
$$

$$
\hat{\mathbf A}[1,0]\times_{T_q}\hat{\mathbf v}[0]=(15,6,15,4),\quad
\hat{\mathbf A}[1,1]\times_{T_q}\hat{\mathbf v}[1]=(3,3,3,3),
$$
$$
\hat{\mathbf w}[1]\equiv(15,6,15,4)+(3,3,3,3)=(18,9,18,7)\equiv(1,9,1,7)\pmod{17}.
$$

è¯´æ˜ï¼šçœŸå® ML-KEM ä¸­æ•°ç»„é•¿åº¦ä¸º 256ï¼Œ$q=3329$ï¼Œ$\zeta_i$ ä¸ºé¢„ç½®å¸¸æ•°ï¼Œæœ¬æ ‡å‡†åº”è¯¥æ”¹ä¸º17



**ç”¨ Alice/Bob è®² LWE å…¬é’¥åŠ å¯†ï¼ˆå«å°ä¾‹å­ï¼‰**

LWE çš„ç›´è§‰ï¼šå…¬é’¥é‡Œå­˜çš„æ˜¯ä¸€å †â€œå¸¦å™ªçº¿æ€§æ–¹ç¨‹â€ $a_i\cdot s \approx b_i \pmod q$ï¼Œåªæœ‰çŸ¥é“ç§˜å¯†å‘é‡ $s$ çš„äººï¼Œæ‰èƒ½æŠŠâ€œè¿‘/è¿œâ€ä¸¤ç§æƒ…å†µåŒºåˆ†å¼€æ¥ï¼Œä»è€Œè§£å¯†ã€‚

---

**æµç¨‹ï¼ˆæ¦‚å¿µï¼‰**

**KeyGenï¼ˆBob åšï¼‰**

å–æ¨¡æ•° $q$ï¼ŒéšæœºçŸ©é˜µ $A\in\mathbb Z_q^{m\times n}$ï¼Œç§˜å¯†å‘é‡ $s\in\mathbb Z_q^{n}$ï¼Œå°å™ªå£° $e\in\mathbb Z^m$ã€‚è®¡ç®—
$$
b = A s + e \pmod q .
$$
å…¬é’¥ $pk=(A,b)$ï¼Œç§é’¥ $sk=s$ã€‚

**Encryptï¼ˆAlice åšï¼Œç»™ Bob å‘ä¸€ä½æ¶ˆæ¯æ¯”ç‰¹ $\mu\in\{0,1\}$ï¼‰**

å–éšæœº $r\in\{0,1\}^m$ ä¸å°å™ªå£° $e_1\in\mathbb Z^n,\ e_2\in\mathbb Z$ï¼Œè®¡ç®—
$$
u = A^{\top} r + e_1\in\mathbb Z_q^{n},\qquad
v = b^{\top} r + e_2 + \mu\cdot\left\lfloor\frac{q}{2}\right\rfloor\in\mathbb Z_q.
$$
å¯†æ–‡ä¸º $(u,v)$ã€‚

**Decryptï¼ˆBob åšï¼‰**

ç”¨ç§é’¥ $s$ è®¡ç®—
$$
t = v - s^{\top}u \pmod q .
$$
è‹¥ $t$ é è¿‘ $0$ åˆ¤ä¸º $\mu=0$ï¼›è‹¥é è¿‘ $q/2$ åˆ¤ä¸º $\mu=1$ã€‚

---

**è¿·ä½ æ•°å­—ä¾‹å­ï¼ˆç©å…·å‚æ•°ï¼Œä¾¿äºæ‰‹ç®—ï¼‰**

å– $q=23,\ n=2,\ m=3$ã€‚Bob ç”Ÿæˆï¼š
$$
A=\begin{pmatrix}4&1\\[2pt] 7&5\\[2pt] 2&9\end{pmatrix},\qquad
s=\begin{pmatrix}7\\[2pt]3\end{pmatrix},\qquad
e=\begin{pmatrix}1\\[2pt]-1\\[2pt]0\end{pmatrix}.
$$
å…ˆç®— $A s=(8,18,18)$ï¼Œäºæ˜¯
$$
b=(A s+e)\bmod 23=(9,17,18).
$$
å…¬é’¥ $pk=(A,b)$ï¼Œç§é’¥ $s$ã€‚

**Alice åŠ å¯†** ä¸€ä½ $\mu$ï¼š
å– $r=(1,0,1)$ï¼Œ$e_1=(0,1)$ï¼Œ$e_2=1$ã€‚åˆ™
$$
u=A^{\top}r+e_1=(6,11)\pmod{23}.
$$
åˆæœ‰ $b^{\top}r=9+18=27\equiv4\pmod{23}$ï¼Œäºæ˜¯
$$
\mu=0:\ v=4+1=5;\qquad
\mu=1:\ v=4+1+\left\lfloor\frac{23}{2}\right\rfloor=16.
$$

**Bob è§£å¯†**ï¼š
å…ˆç®—
$$
s^{\top}u=7\cdot6+3\cdot11=75\equiv6\pmod{23}.
$$
- æ”¶åˆ° $v=5$ï¼š$t=5-6\equiv22\equiv-1$ï¼ˆæ¥è¿‘ $0$ï¼‰$\Rightarrow\ \mu=0$ã€‚  
- æ”¶åˆ° $v=16$ï¼š$t=16-6=10$ï¼ˆæ¥è¿‘ $11\approx q/2$ï¼‰$\Rightarrow\ \mu=1$ã€‚

> æ³¨ï¼šçœŸå®æ–¹æ¡ˆä¼šé€‰æ›´å¤§çš„å‚æ•°ï¼ˆä¾‹å¦‚ $q=3329$ ç­‰ï¼‰ï¼Œå¹¶æŠŠä¸Šé¢â€œåŠ å¯†ä¸€ä½â€çš„æ€æƒ³åŒ…è£…æˆ KEM æˆ–å¤šæ¯”ç‰¹ PKEï¼›è¿™é‡Œçš„ä¾‹å­ä»…ç”¨äºå±•ç¤ºå½¢çŠ¶ä¸è¿ç®—è§„åˆ™ã€‚

## è¾…åŠ©åŠ å¯†ç®—æ³•

##### PRF

![image-20251105165636210](F:\typoraphoto\image-20251105165636210.png)



æ„æ€å°±æ˜¯ä¸‰ä¸ªè¾“å…¥ï¼Œ

`Î·`ï¼ˆ2æˆ–è€…3ï¼‰ï¼šæ§åˆ¶è¾“å‡ºé•¿åº¦ï¼Œ128/196å­—èŠ‚é•¿åº¦çš„éšæœºæ•°

`s`ï¼ˆ32 å­—èŠ‚ï¼‰ï¼šé€šå¸¸æ˜¯**é•¿æœŸå¯†é’¥æˆ–æ ¸å¿ƒè¾“å…¥**ï¼ˆæ¯”å¦‚ä¸»å¯†é’¥ã€ç§å­ç­‰ï¼‰ï¼Œå…·æœ‰ â€œæŒä¹…æ€§â€ è¯­ä¹‰ã€‚

`b`ï¼ˆ1 å­—èŠ‚ï¼‰ï¼šé€šå¸¸æ˜¯**ä¸´æ—¶å‚æ•°æˆ–ä¸Šä¸‹æ–‡æ ‡è¯†**ï¼ˆæ¯”å¦‚è®¡æ•°å™¨ã€æ¶ˆæ¯æ ‡ç­¾ã€åè®®é˜¶æ®µæ ‡è®°ç­‰ï¼‰ï¼Œå…·æœ‰ â€œå¤šå˜æ€§â€ è¯­ä¹‰ã€‚

ç”±SHAKE256ç”Ÿæˆä¼ªéšæœºæ•°

##### SHAKE128

åŠ å¯†å‡½æ•°ï¼Œè¾“å…¥è¦åŠ å¯†çš„å­—ç¬¦ä¸²strå’Œè¾“å‡ºçš„é•¿åº¦bï¼Œæœ‰ä¸‰ä¸ªå°è£…å‡½æ•°

![image-20251105192841667](F:\typoraphoto\image-20251105192841667.png)

![image-20251105192857368](F:\typoraphoto\image-20251105192857368.png)

æ³¨æ„XOF.Squeezeçš„è¾“å…¥æ˜¯å­—èŠ‚æ•°ï¼ŒSHAKER128.Squeezeä¸ºæ¯”ç‰¹æ•°

![image-20251105192940650](F:\typoraphoto\image-20251105192940650.png)

è¿™é‡Œå¸æ”¶æ˜¯Bå½“ä½œç§å­ï¼ŒæŠŠctx[0]->ctx[1]æ›´æ–°ï¼Œç„¶åå¥½ç»™ä¸‹æ¬¡æŒ¤å‹ï¼ŒæŒ¤å‹åï¼Œå°±ä¼šç”Ÿæˆzå­—èŠ‚çš„ä¼ªéšæœºä¸²ï¼Œç„¶åæ›´æ–°ctx[1]->ctx[2]ï¼Œè¿™æ ·ä¸‹æ¬¡ä½¿ç”¨å°±ä¸ä¼šé‡å¤ï¼Œä¾ç„¶ç”Ÿæˆå¦ä¸€ä¸ªä¼ªéšæœºä¸²äº†



##### Conversion and Compression Algorithms

###### Conversionï¼Œä½æ•°ç»„å’Œå­—èŠ‚æ•°ç»„çš„è½¬æ¢

BitsToBytes() and BytesToBits()

æ³¨æ„ï¼Œè¿™é‡Œæ˜¯ä½æ•°ç»„ä¸ºå°ç«¯åºlittle-endian order	the 8-bit string 11010001 corresponds to the byte \(2^0 + 2^1 + 2^3 + 2^7 = 139\).	

![image-20251105193138624](F:\typoraphoto\image-20251105193138624.png)

###### Compression and decompression

- **Compress<sub>d</sub>**: $\mathbb{Z}_q \rightarrow \mathbb{Z}_{2^d}$  	$x \mapsto \left\lfloor \left( \frac{2^d}{q} \cdot x \right) \right\rfloor \mod 2^d$
  
- **Decompress<sub>d</sub>**: $\mathbb{Z}_{2^d} \rightarrow \mathbb{Z}_q$  	$y \mapsto \left\lfloor \left( \frac{q}{2^d} \cdot y \right) \right\rfloor$
  

Compress æ˜¯ â€œ**ç¼©æ”¾åå–æ¨¡**â€ï¼Œå°†å¤§æ¨¡æ•°*q*çš„æ•°æ˜ å°„åˆ°å°æ¨¡æ•°2*d*çš„æ•°ï¼›æ¯”å¦‚ è®¾d=5ï¼Œx=1664å‹ç¼©åy=15

Decompress æ˜¯ â€œ**åå‘ç¼©æ”¾åå–æ•´**â€ï¼Œå°†å°æ¨¡æ•°2*d*çš„æ•°æ˜ å°„å›å¤§æ¨¡æ•°*q*çš„æ•°ï¼›y=15,æ–¹å‹ç¼©åçš„x=1560

ç”±äº*d*<12ï¼ˆ*q*çš„æ¯”ç‰¹é•¿åº¦æ˜¯ 12ï¼‰ï¼Œå‹ç¼©è¿‡ç¨‹ä¼šä¸¢å¤±éƒ¨åˆ†ä¿¡æ¯ï¼Œè§£å‹ç¼©åå­˜åœ¨è¯¯å·®ï¼ˆå¦‚ä¾‹ä¸­1664\\=1560ï¼‰ï¼Œè¿™ç§è¿‘ä¼¼æ€§åœ¨æ ¼å¯†ç ç­‰é¢†åŸŸç”¨äºå®ç°é«˜æ•ˆçš„å¯†ç å­¦åŸè¯­ã€‚

Compress ä¸ Decompress çš„**æ€§è´¨**

Compress å’Œ Decompress ç®—æ³•æ»¡è¶³ä¸¤ä¸ªé‡è¦æ€§è´¨ï¼š

1. **Decompress åå† Compress èƒ½è¿˜åŸè¾“å…¥**ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼š
   $$
   \text{Compress}_d(\text{Decompress}_d(y)) = y \quad \text{å¯¹äºæ‰€æœ‰ } y \in \mathbb{Z}_{2^d} \text{ ä¸” } d < 12
   $$
   
2. å½“ $d$ å–è¾ƒå¤§å€¼ï¼ˆå³æ¥è¿‘ 12ï¼‰æ—¶ï¼Œ**Compress åå† Decompress æ‰€é€ æˆçš„è¯¯å·®å¯ä»¥å¿½ç•¥**ï¼Œä¸ä¼šæ˜¾è‘—æ”¹å˜æ•°å€¼ã€‚

##### Encoding and decoding

å­—èŠ‚æ•°ç»„å’Œæ¨¡mæ•´æ•°æ•°ç»„çš„ç½®æ¢ï¼ˆå…¶ä¸­éœ€è¦ç”¨åˆ°ä½æ•°ç»„å’Œå­—èŠ‚æ•°ç»„çš„è½¬æ¢BitsToBytes() and BytesToBits()ï¼‰

è¿™é‡Œmæ³¨æ„æœ‰ä¸¤ä¸ªå–å€¼åˆ¤æ–­ï¼ŒBtyeDecodeè¦mod mï¼Œå› ä¸ºå½“d=12ï¼Œm=q=3329çš„æ—¶å€™ï¼Œå°äº$2^d$,å­—èŠ‚æ•°å¯èƒ½å¤§äºmäº†

![image-20251105201424831](F:\typoraphoto\image-20251105201424831.png)

##### Sampling Algorithms

###### Uniform sampling of NTT representations. 

Both of these algorithms can be used to convert a stream of uniformly random bytes into a sample from some desired distribution.

æ„æ€å°±æ˜¯è¾“å…¥B(32å­—èŠ‚ç§å­+2å­—èŠ‚ç´¢å¼•)ï¼Œä½¿ç”¨ä¼ªéšæœºç”Ÿæˆå™¨XOF=SHAKE128ï¼Œè®¡ç®—$\hat{a} \in \mathbb{Z}_q^{256}$ï¼Œå¾—åˆ°ä¸€ä¸ª$T_q$, å¤šé¡¹å¼çš„valueè¡¨ç¤ºï¼Œä½œä¸º$\hat{A}$çš„å…ƒç´ 

![image-20251110131832095](F:\typoraphoto\image-20251110131832095.png)

###### Sampling from the centered binomial distribution.

ç”¨äºä»è¾“å…¥ç§å­ç”Ÿæˆç¬¦åˆåˆ†å¸ƒ $D_Î·(R_q)$ çš„å¤šé¡¹å¼ã€‚å…¶ä¸­  $D_Î·(R_q)$æ˜¯**ä¸­å¿ƒå¯¹ç§°çš„ç¦»æ•£åˆ†å¸ƒ**ï¼ˆç³»æ•°ç»å¯¹å€¼ä¸è¶…è¿‡ *Î·*ï¼‰ï¼Œè¿™ç±»å¤šé¡¹å¼å¸¸ç”¨äºç”Ÿæˆ**å™ªå£°**,

è¾“å…¥ä¸€ä¸ªB(64*Î·å­—èŠ‚)å½“æˆç§å­ï¼ŒÎ·å½“ä½œå™ªå£°çš„å¤§å°è¾¹ç•Œï¼Œç„¶åæŠŠByteè½¬ä¸ºBitï¼Œxå’Œyæ˜¯b[]ä¸­ä¸¤ä¸ªÎ·å¤§å°å…ƒç´ ä¸­ï¼Œå‰ä¸€ä¸ªÎ·çš„å’Œ å‡ åä¸€ä¸ªÎ·çš„å’Œï¼Œå¾—åˆ°çš„ç»“æœä¾ç„¶æ˜¯$-Î·<=f<=Î·$ï¼Œç”Ÿæˆå™ªéŸ³å¤šé¡¹å¼ã€‚

**Î· æ˜¯é¢„å…ˆç»™å®šçš„åˆ†å¸ƒå‚æ•°**ï¼Œå±äº ML-KEM åè®®ä¸­å®šä¹‰çš„å›ºå®šå¸¸é‡ï¼ˆä¾‹å¦‚æ ‡å‡†å‚æ•°ä¸­ Î·=2ï¼‰ã€‚å®ƒç”¨äºå®šä¹‰ä¸­å¿ƒå¯¹ç§°åˆ†å¸ƒ *D**Î·*(*R**q*) çš„èŒƒå›´ï¼Œå³è¾“å‡ºå¤šé¡¹å¼çš„ç³»æ•°ç»å¯¹å€¼ä¸è¶…è¿‡ Î·ï¼Œæ˜¯ç®—æ³•çš„å·²çŸ¥è¾“å…¥å‚æ•°ï¼Œå±äº â€œç»™å®šâ€ çš„èŒƒç•´ã€‚

![image-20251110133410156](F:\typoraphoto\image-20251110133410156.png)

###### The mathematical structure of the NTT.

 In ML-KEM, ğ‘ is the prime 3329 = 28 â‹… 13 + 1, andğ‘› = 256. There are 128 primitive 256-th roots of unity and no primitive 512-th roots of unity inâ„¤ğ‘. Note that ğœ = 17 âˆˆ â„¤ğ‘ is a primitive 256-th root of unity modulo ğ‘. Thus, $ğœ_128$ â‰¡ âˆ’1.

ä¸ºä»€ä¹ˆn=256ï¼Ÿ

## é—®é¢˜

**é—®é¢˜ï¼šä¸ºä»€ä¹ˆml-kenç”¨ç¯ï¼Œè€Œä¸æ˜¯åŸŸ/ç¾¤**

### **CRYSTALS-KYBER**
